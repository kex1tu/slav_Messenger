/**
 * @file main.cpp
 * @brief Точка входа в серверное приложение чата.
 *
 * @details Этот файл содержит функцию `main`, которая является первой функцией,
 * вызываемой при запуске сервера. Ее основные задачи:
 * 1. Создать экземпляр `QCoreApplication` - ядро любого консольного Qt-приложения.
 * 2. Создать главный объект сервера (`Server`).
 * 3. Запустить сервер для прослушивания входящих подключений.
 * 4. Запустить главный цикл обработки событий Qt, который будет поддерживать
 *    работу сервера в асинхронном режиме.
 */

#include <QCoreApplication> // Основной класс для консольных приложений Qt.
#include <QDebug>           // Для вывода критических ошибок (qCritical).
#include "server.h"         // Включаем заголовочный файл нашего серверного класса.

/**
 * @brief Главная функция, точка входа в программу.
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк, содержащий аргументы командной строки.
 * @return int Код завершения программы. 0 в случае успеха, 1 в случае ошибки.
 */
int main(int argc, char *argv[])
{
    // 1. Создание объекта QCoreApplication.
    //    Этот объект управляет циклом обработки событий, таймерами, сетевыми
    //    операциями и другими асинхронными задачами без необходимости
    //    создавать графический интерфейс.
    QCoreApplication a(argc, argv);

    // 2. Создание главного объекта сервера.
    //    Вся логика сервера инкапсулирована в классе `Server`.
    Server server;

    // 3. Попытка запустить сервер для прослушивания портов.
    //    Метод `listen()` возвращает `true` в случае успеха и `false` в случае неудачи.
    if (!server.listen()) {
        // Если сервер не смог запуститься (например, порты уже заняты),
        // выводим критическую ошибку в консоль.
        qCritical() << "Server could not start!";

        // Завершаем приложение с ненулевым кодом, сигнализируя об ошибке.
        return 1;
    }

    // 4. Запуск главного цикла обработки событий Qt.
    //    Эта функция блокирует выполнение и передает управление Qt.
    //    Она будет выполняться "вечно", пока приложение не будет завершено.
    //    В этом цикле Qt будет обрабатывать входящие подключения, поступление
    //    данных в сокеты, срабатывание таймеров и т.д., вызывая
    //    соответствующие слоты в нашем объекте `server`.
    return a.exec();
}

